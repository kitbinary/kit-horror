[gd_scene load_steps=10 format=3 uid="uid://cyccgyrkjhwts"]

[ext_resource type="PackedScene" uid="uid://dco6utwamcvey" path="res://Scenes/Character.tscn" id="1_5rqf2"]
[ext_resource type="Script" path="res://Scripts/Enemy.gd" id="2_4vud8"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_shnrb"]

[sub_resource type="CapsuleMesh" id="CapsuleMesh_ohg0y"]

[sub_resource type="SphereShape3D" id="SphereShape3D_85egi"]
radius = 12.0

[sub_resource type="SphereShape3D" id="SphereShape3D_fdnds"]
radius = 4.0

[sub_resource type="ConvexPolygonShape3D" id="ConvexPolygonShape3D_gpa0d"]
points = PackedVector3Array(0, 0, 0, 12, -2, -12, -12, -2, -12, 0, 0.5, 0, 12, 3.5, -12, -12, 3.5, -12)

[sub_resource type="ConvexPolygonShape3D" id="ConvexPolygonShape3D_rc67i"]
points = PackedVector3Array(0, 0, 0, 6, -1, -6, -6, -1, -6, 0, 0.5, 0, 6, 2, -6, -6, 2, -6)

[sub_resource type="NavigationMesh" id="NavigationMesh_yw3jn"]
vertices = PackedVector3Array(-24.25, 0.45, -31.5, -31.5, 0.45, -31.5, -31.5, 0.45, -24.25, -17, 0.45, -31.5, -24.25, 0.45, -31.5, -31.5, 0.45, -24.25, -17, 0.45, -31.5, -31.5, 0.45, -24.25, -31.5, 0.45, -16.75, -9.75, 0.45, -31.5, -4.25, 0.45, -3, -2.25, 0.45, -3, -2.25, 0.45, -31.5, -9.75, 0.45, -31.5, -31.5, 0.45, -16.75, -31.5, 0.45, -9.25, -31.5, 0.45, -1.75, -4.5, 0.45, -1.75, -4.25, 0.45, -3, -31.5, 0.45, -9.25, -2.25, 0.45, -3, 2.5, 0.45, -3, 2.5, 0.45, -31.5, -2.25, 0.45, -31.5, 31.5, 0.45, -24.25, 31.5, 0.45, -31.5, 24.25, 0.45, -31.5, 31.5, 0.45, -24.25, 24.25, 0.45, -31.5, 17, 0.45, -31.5, 31.5, 0.45, -16.75, 31.5, 0.45, -24.25, 17, 0.45, -31.5, 9.75, 0.45, -31.5, 2.5, 0.45, -31.5, 2.5, 0.45, -3, 4.5, 0.45, -3, 31.5, 0.45, -9.25, 31.5, 0.45, -16.75, 9.75, 0.45, -31.5, 4.5, 0.45, -3, 4.75, 0.45, -1.75, 31.5, 0.45, -1.75, 31.5, 0.45, -9.25, -31.5, 0.45, 23, -31.5, 0.45, 31.5, -24.5, 0.45, 31.5, -31.5, 0.45, 23, -24.5, 0.45, 31.5, -17.25, 0.45, 31.5, -31.5, 0.45, 14.75, -31.5, 0.45, 23, -17.25, 0.45, 31.5, -10.25, 0.45, 31.5, -2.75, 0.45, -0.75, -4.25, 0.45, -0.75, -31.5, 0.45, 6.5, -31.5, 0.45, 14.75, -10.25, 0.45, 31.5, -3, 0.45, 31.5, -4.25, 0.45, -0.75, -4.5, 0.45, -1.75, -31.5, 0.45, -1.75, -31.5, 0.45, 6.5, 24.25, 0.45, 31.5, 31.5, 0.45, 31.5, 31.5, 0.45, 23, 17.25, 0.45, 31.5, 24.25, 0.45, 31.5, 31.5, 0.45, 23, 17.25, 0.45, 31.5, 31.5, 0.45, 23, 31.5, 0.45, 14.75, 10.25, 0.45, 31.5, 31.5, 0.45, -1.75, 4.75, 0.45, -1.75, 4.5, 0.45, -0.75, 31.5, 0.45, 6.5, 31.5, 0.45, 6.5, 4.5, 0.45, -0.75, 3, 0.45, -0.75, 3.25, 0.45, 31.5, 10.25, 0.45, 31.5, 31.5, 0.45, 14.75, -3, 0.45, 31.5, 3.25, 0.45, 31.5, 3, 0.45, -0.75, -2.75, 0.45, -0.75)
polygons = [PackedInt32Array(2, 1, 0), PackedInt32Array(5, 4, 3), PackedInt32Array(7, 6, 8), PackedInt32Array(8, 6, 9), PackedInt32Array(11, 10, 12), PackedInt32Array(12, 10, 13), PackedInt32Array(13, 10, 14), PackedInt32Array(14, 10, 15), PackedInt32Array(17, 16, 18), PackedInt32Array(18, 16, 19), PackedInt32Array(23, 22, 20), PackedInt32Array(20, 22, 21), PackedInt32Array(26, 25, 24), PackedInt32Array(29, 28, 27), PackedInt32Array(31, 30, 32), PackedInt32Array(32, 30, 33), PackedInt32Array(35, 34, 36), PackedInt32Array(36, 34, 39), PackedInt32Array(36, 39, 38), PackedInt32Array(36, 38, 37), PackedInt32Array(41, 40, 42), PackedInt32Array(42, 40, 43), PackedInt32Array(46, 45, 44), PackedInt32Array(48, 47, 49), PackedInt32Array(52, 51, 53), PackedInt32Array(53, 51, 50), PackedInt32Array(55, 54, 56), PackedInt32Array(56, 54, 57), PackedInt32Array(57, 54, 58), PackedInt32Array(58, 54, 59), PackedInt32Array(61, 60, 62), PackedInt32Array(62, 60, 63), PackedInt32Array(66, 65, 64), PackedInt32Array(69, 68, 67), PackedInt32Array(70, 73, 71), PackedInt32Array(71, 73, 72), PackedInt32Array(75, 74, 76), PackedInt32Array(76, 74, 77), PackedInt32Array(79, 78, 80), PackedInt32Array(80, 78, 83), PackedInt32Array(80, 83, 82), PackedInt32Array(80, 82, 81), PackedInt32Array(87, 86, 84), PackedInt32Array(84, 86, 85)]
agent_height = 2.0

[node name="TestScene" type="Node3D"]

[node name="Character" parent="." groups=["audible", "character", "visible"] instance=ExtResource("1_5rqf2")]
transform = Transform3D(-1, 0, -8.74228e-08, 0, 1, 0, 8.74228e-08, 0, -1, 21.9504, 0.346872, -17.3563)

[node name="Enemy" type="CharacterBody3D" parent="." node_paths=PackedStringArray("waypoints")]
transform = Transform3D(-4.37114e-08, 0, 1, 0, 1, 0, -1, 0, -4.37114e-08, 0, 1.1118, 5.27936)
script = ExtResource("2_4vud8")
waypoints = [NodePath("../PatrolMarkers/Marker3D"), NodePath("../PatrolMarkers/Marker3D2")]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Enemy"]
shape = SubResource("CapsuleShape3D_shnrb")

[node name="MeshInstance3D" type="MeshInstance3D" parent="Enemy"]
mesh = SubResource("CapsuleMesh_ohg0y")

[node name="Face" type="MeshInstance3D" parent="Enemy"]
transform = Transform3D(-2.32353e-08, -0.308554, -1.61616e-08, 0, -1.34873e-08, 0.369735, -0.531561, 1.34873e-08, 7.06446e-16, 0, 0.5, -0.25)
mesh = SubResource("CapsuleMesh_ohg0y")

[node name="EnemyNavAgent" type="NavigationAgent3D" parent="Enemy"]

[node name="PatrolTimer" type="Timer" parent="Enemy"]
wait_time = 3.0
one_shot = true

[node name="HearingFar" type="Area3D" parent="Enemy"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Enemy/HearingFar"]
shape = SubResource("SphereShape3D_85egi")

[node name="HearingClose" type="Area3D" parent="Enemy"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Enemy/HearingClose"]
shape = SubResource("SphereShape3D_fdnds")

[node name="SightFar" type="Area3D" parent="Enemy"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Enemy/SightFar"]
shape = SubResource("ConvexPolygonShape3D_gpa0d")

[node name="SightClose" type="Area3D" parent="Enemy"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Enemy/SightClose"]
shape = SubResource("ConvexPolygonShape3D_rc67i")

[node name="World" type="NavigationRegion3D" parent="."]
navigation_mesh = SubResource("NavigationMesh_yw3jn")

[node name="Floor" type="CSGBox3D" parent="World"]
use_collision = true
size = Vector3(64, 0.1, 64)

[node name="Roof" type="CSGBox3D" parent="World"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.5, -1.824)
use_collision = true
size = Vector3(8, 0.5, 1)

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.0128976, 0.999917, 0, -0.999917, 0.0128976, 0, 6.55943, 5.65432)

[node name="PatrolMarkers" type="Node3D" parent="."]

[node name="Marker3D" type="Marker3D" parent="PatrolMarkers"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5.45898, 0, 5.5968)

[node name="Marker3D2" type="Marker3D" parent="PatrolMarkers"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -6.54102, 0, 5.5968)

[connection signal="timeout" from="Enemy/PatrolTimer" to="Enemy" method="_on_patrol_timer_timeout"]
[connection signal="body_entered" from="Enemy/HearingFar" to="Enemy" method="_on_hearing_far_body_entered"]
[connection signal="body_exited" from="Enemy/HearingFar" to="Enemy" method="_on_hearing_far_body_exited"]
[connection signal="body_entered" from="Enemy/HearingClose" to="Enemy" method="_on_hearing_close_body_entered"]
[connection signal="body_exited" from="Enemy/HearingClose" to="Enemy" method="_on_hearing_close_body_exited"]
[connection signal="body_entered" from="Enemy/SightFar" to="Enemy" method="_on_sight_far_body_entered"]
[connection signal="body_exited" from="Enemy/SightFar" to="Enemy" method="_on_sight_far_body_exited"]
[connection signal="body_entered" from="Enemy/SightClose" to="Enemy" method="_on_sight_close_body_entered"]
[connection signal="body_exited" from="Enemy/SightClose" to="Enemy" method="_on_sight_close_body_exited"]
